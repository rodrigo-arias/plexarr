name: streaming

networks:
  proxy:
    external: true   # Connect to the same proxy network for NPM access

services:
  # --- Plex Media Server: stream movies and TV shows
  plex:
    image: lscr.io/linuxserver/plex:latest
    container_name: plex
    restart: unless-stopped
    environment:
      PUID: ${PUID}
      PGID: ${PGID}
      TZ: ${TZ}
      VERSION: docker
    volumes:
      - ${APPDATA_ROOT}/streaming/plex/config:/config
      - ${MEDIA_ROOT}/movies:/movies
      - ${MEDIA_ROOT}/tv:/tv
      - ${MEDIA_ROOT}/transcode:/transcode   # optional SSD for better transcoding
    expose:
      - "32400"   # Plex main port
    networks: [proxy]

  # --- Tautulli: monitor Plex activity and stats
  tautulli:
    image: lscr.io/linuxserver/tautulli:latest
    container_name: tautulli
    restart: unless-stopped
    environment:
      PUID: ${PUID}
      PGID: ${PGID}
      TZ: ${TZ}
    volumes:
      - ${APPDATA_ROOT}/streaming/tautulli/config:/config
    expose:
      - "8181"   # Web UI
    networks: [proxy]
    depends_on:
      - plex
